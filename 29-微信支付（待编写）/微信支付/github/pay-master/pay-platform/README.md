# 支付平台

#### web-common
* 一些公共的spring组件，util

#### pay-api
* 支付平台

#### pay-service
* 支付逻辑， 微信支付，支付宝支付

#### pay-api-model 
* ***支付平台对外提供的接口参数和返回值类型，以及签名计算法方式， 业务方引用 此工程， 调用样例均在 pay-api的test目录和pay-caller工程。***

#### pay-caller
* 业务方，通过http请求或者封装好的http的sdk 调用支付平台

#### pay-admin
* 支付平台后台


#### 支付平台主要功能
* 统一下单，网页支付，扫码支付，app支付
* 支付成功异步通知
* 订单查询，同步payOrder
* 订单退款，查询退款
* 后台系统
* 微信刷卡支付 
    * api以已经调通，但是没有集成到支付平台（如果需要客户输入密码，则订单支付状态为支付中，需要支付平台定时轮询状态，直到成功或超时）

#### 主要模块
* 商户管理，业务方接入
* 渠道管理（微信，支付宝支付账号），  商户与渠道做关联
* 对账管理
* 订单管理（订单后台）
* 退款管理
* 安全管理（加签名）
* 日志管理（异常日志分析）



#### 注意事项
* 微信退款 需要数字证书
* [支付宝常见注意事项](https://doc.open.alipay.com/doc2/detail.htm?spm=a219a.7629140.0.0.IH0sUA&treeId=26&articleId=103279&docType=1)
* 支付宝支付需要依赖 [alipay-sdk](https://doc.open.alipay.com/doc2/detail?treeId=54&articleId=103419&docType=1#s2)
* 支付宝支付 需要预先在支付宝开放平台设置 支付宝公钥和私钥，[文档](https://doc.open.alipay.com/doc2/detail.htm?spm=a219a.7629140.0.0.7W7fUQ&treeId=44&articleId=103242&docType=1)
* 支付宝开放平台一个账号可以创建多个应用，如当面付（扫码支付）， 手机网站支付， app支付，  共用一个合作伙伴身份（PID）
    * 账户及秘钥管理-PID和公钥管理-合作伙伴秘钥 
    * pid一致，但是appId 每个应用一个
    * 支付宝如果创建应用，则使用 合作伙伴秘钥里面的 开发者公钥（商户公钥）和支付宝公钥
    * [查看RSA商户公钥与支付宝公钥](https://doc.open.alipay.com/doc2/detail?treeId=58&articleId=103546&docType=1)
* ***支付宝支付采用了RSA加密签名的安全通信机制，开发者可以通过支付宝的公钥验证消息的来源，同时使用自己的私钥（商户私钥）进行信息加密***
    * ***集成支付宝支付，我们需要在本地留有  商户私钥，支付宝公钥，  在开放平台设置 商户公钥。***  
    * ***支付宝私钥，公钥由开放平台提供。***
    * ***支付宝公钥不用设置，申请开通支付宝开放平台后，支付宝会给我们分配一个支付宝公钥，在 账户及秘钥管理-PID和公钥管理-开放平台秘钥，   这个秘钥用于支付宝开放平台，如服务窗口等服务。***
    * ***如果创建应用，则在  账户及秘钥管理-PID和公钥管理-合作伙伴秘钥 ， 设置 商户公钥(开发者公钥)后，支付宝公钥会自动分配给我们。***
    * ***支付宝推荐使用rsa加密方式。***
* ***eb 扫码使用的时候  服务窗应用 开放平台秘钥，wap和app支付使用的合作伙伴秘钥***
